import{q as e,$ as s,a4 as t,a0 as n,D as o,R as i,o as c,M as f,ag as r,T as a}from"./render.BkFXjsAB.js";class h{anchor;#e=new Map;#s=new Map;#t=new Map;#n=new Set;#o=!0;constructor(e,s=!0){this.anchor=e,this.#o=s}#i=()=>{var i=e;if(this.#e.has(i)){var c=this.#e.get(i),f=this.#s.get(c);if(f)s(f),this.#n.delete(c);else{var a=this.#t.get(c);a&&(this.#s.set(c,a.effect),this.#t.delete(c),a.fragment.lastChild.remove(),this.anchor.before(a.fragment),f=a.effect)}for(const[e,s]of this.#e){if(this.#e.delete(e),e===i)break;const n=this.#t.get(s);n&&(t(n.effect),this.#t.delete(s))}for(const[e,s]of this.#s){if(e===c||this.#n.has(e))continue;const i=()=>{if(Array.from(this.#e.values()).includes(e)){var n=document.createDocumentFragment();r(s,n),n.append(o()),this.#t.set(e,{effect:s,fragment:n})}else t(s);this.#n.delete(e),this.#s.delete(e)};this.#o||!f?(this.#n.add(e),n(s,i,!1)):i()}}};#c=e=>{this.#e.delete(e);const s=Array.from(this.#e.values());for(const[n,o]of this.#t)s.includes(n)||(t(o.effect),this.#t.delete(n))};ensure(s,t){var n=e,r=a();if(t&&!this.#s.has(s)&&!this.#t.has(s))if(r){var h=document.createDocumentFragment(),d=o();h.append(d),this.#t.set(s,{effect:i(()=>t(d)),fragment:h})}else this.#s.set(s,i(()=>t(this.anchor)));if(this.#e.set(n,s),r){for(const[e,t]of this.#s)e===s?n.unskip_effect(t):n.skip_effect(t);for(const[e,t]of this.#t)e===s?n.unskip_effect(t.effect):n.skip_effect(t.effect);n.oncommit(this.#i),n.ondiscard(this.#c)}else c&&(this.anchor=f),this.#i()}}export{h as B};

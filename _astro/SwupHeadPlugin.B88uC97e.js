import{e}from"./index.modern.CakIiLFM.js";function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)({}).hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},t.apply(null,arguments)}function s(e){return"title"!==e.localName&&!e.matches("[data-swup-theme]")}function n(e,t){return e.outerHTML===t.outerHTML}function r(e,t=[]){const s=Array.from(e.attributes);return t.length?s.filter(({name:e})=>t.some(t=>t instanceof RegExp?t.test(e):e===t)):s}function o(e){return e.matches("link[rel=stylesheet][href]")}class i extends e{constructor(e={}){var i;super(),i=this,this.name="SwupHeadPlugin",this.requires={swup:">=4.6"},this.defaults={persistTags:!1,persistAssets:!1,awaitAssets:!1,attributes:["lang","dir"],timeout:3e3},this.options=void 0,this.updateHead=async function(e,{page:{}}){const{awaitAssets:a,attributes:l,timeout:u}=i.options,c=e.to.document,{removed:d,added:h}=function(e,r,{shouldPersist:o=()=>!1}={}){const i=Array.from(e.children),a=Array.from(r.children),l=(u=i,a.reduce((e,t,s)=>(u.some(e=>n(t,e))||e.push({el:t,index:s}),e),[]));var u;const c=function(e,t){return e.reduce((e,s)=>(t.some(e=>n(s,e))||e.push({el:s}),e),[])}(i,a);c.reverse().filter(({el:e})=>s(e)).filter(({el:e})=>!o(e)).forEach(({el:t})=>e.removeChild(t));const d=l.filter(({el:e})=>s(e)).map(s=>{let n=s.el.cloneNode(!0);return e.insertBefore(n,e.children[(s.index||0)+1]||null),t({},s,{el:n})});return{removed:c.map(({el:e})=>e),added:d.map(({el:e})=>e)}}(document.head,c.head,{shouldPersist:e=>i.isPersistentTag(e)});if(i.swup.log(`Removed ${d.length} / added ${h.length} tags in head`),null!=l&&l.length&&function(e,t,s=[]){const n=new Set;for(const{name:o,value:i}of r(t,s))e.setAttribute(o,i),n.add(o);for(const{name:o}of r(e,s))n.has(o)||e.removeAttribute(o)}(document.documentElement,c.documentElement,l),a){const e=function(e,t=0){return e.filter(o).map(e=>function(e,t=0){let s;const n=t=>{e.sheet?t():s=setTimeout(()=>n(t),10)};return new Promise(r=>{n(()=>r(e)),t>0&&setTimeout(()=>{s&&clearTimeout(s),r(e)},t)})}(e,t))}(h,u);e.length&&(i.swup.log(`Waiting for ${e.length} assets to load`),await Promise.all(e))}},this.options=t({},this.defaults,e),this.options.persistAssets&&!this.options.persistTags&&(this.options.persistTags="link[rel=stylesheet], script[src], style")}mount(){this.before("content:replace",this.updateHead)}isPersistentTag(e){const{persistTags:t}=this.options;return"function"==typeof t?t(e):"string"==typeof t&&t.length>0?e.matches(t):Boolean(t)}}export{i as default};

import{_ as e}from"./preload-helper.BhLMWRjL.js";import{p as t,u as o}from"./url-utils.dF1rs-l4.js";import{n,o as s,p as i,B as a,q as d,r}from"./setting-utils.DqugXRwS.js";import{s as l}from"./zh_TW.49pB-Yd8.js";function c(){function e(e){if(e.hasAttribute("data-icon-initialized"))return;e.setAttribute("data-icon-initialized","true");const t=e.querySelector("[data-loading-indicator]"),o=e.querySelector("[data-icon-element]"),n=o?.getAttribute("icon");if(t&&o){if(t.style.display="inline-flex",o.classList.remove("opacity-100"),o.classList.add("opacity-0"),o.addEventListener("load",()=>{i()}),o.addEventListener("error",()=>{n&&console.warn(`Failed to load icon: ${n}`)}),window.MutationObserver){const e=new MutationObserver(()=>{s()&&e.disconnect()});e.observe(o,{childList:!0,subtree:!0,attributes:!0}),setTimeout(()=>{e.disconnect(),s()},5e3)}setTimeout(()=>{s()},100)}function s(){return!!(o.shadowRoot&&o.shadowRoot.children.length>0)&&(i(),!0)}function i(){t.style.display="none",o.classList.remove("opacity-0"),o.classList.add("opacity-100")}}if(document.querySelectorAll("[data-icon-container]").forEach(e),window.MutationObserver){new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){const o=t;o.hasAttribute?.("data-icon-container")?e(o):o.querySelectorAll("[data-icon-container]").forEach(e)}})})}).observe(document.body,{childList:!0,subtree:!0})}}const m=Object.freeze(Object.defineProperty({__proto__:null,initIconLoader:c},Symbol.toStringTag,{value:"Module"})),u=!!document.getElementById("wallpaper-wrapper");function h(e,t){document.addEventListener("click",o=>{let n=document.getElementById(e);if(!n)return;let s=o.target;if(s instanceof Node){for(let e of t){let t=document.getElementById(e);if(t==s||t?.contains(s))return}n.classList.add("float-panel-closed")}})}function p(){document.querySelectorAll(".katex-display:not([data-scrollbar-initialized])").forEach(e=>{if(!e.parentNode)return;const t=document.createElement("div");t.className="katex-display-container",e.parentNode.insertBefore(t,e),t.appendChild(e),t.style.cssText="\n\t\t\toverflow-x: auto;\n\t\t",e.setAttribute("data-scrollbar-initialized","true")})}function g(){requestAnimationFrame(()=>{const e=document.getElementById("banner");e&&e.classList.remove("opacity-0","scale-105");const t=document.querySelector('.block.lg\\:hidden[alt="Mobile banner image of the blog"]');t&&(t.classList.remove("opacity-0","scale-105"),t.classList.add("opacity-100"))})}h("display-setting",["display-setting","display-settings-switch"]),h("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]),h("search-panel",["search-panel","search-bar","search-switch"]),h("wallpaper-mode-panel",["wallpaper-mode-panel","wallpaper-mode-switch"]),h("theme-mode-panel",["theme-mode-panel","scheme-switch"]);const w=()=>{window.swup.hooks.on("link:click",(e,{el:o})=>{document.documentElement.style.setProperty("--content-delay","0ms");const n=o.getAttribute("href")||"",s=(()=>{try{return new URL(n,window.location.origin).pathname}catch{return n}})();if(t(s,window.location.pathname)||document.documentElement.classList.add("is-page-transitioning"),u){const e=document.getElementById("navbar-wrapper");if(e){const t=window.innerHeight*(d/100)-88;document.documentElement.scrollTop>=t&&e.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{B(),p(),e(async()=>{const{initIconLoader:e}=await Promise.resolve().then(()=>m);return{initIconLoader:e}},void 0).then(({initIconLoader:e})=>{e()});if(null!==document.getElementById("toc-wrapper")){const e=document.querySelector("table-of-contents");e&&"function"==typeof e.init&&setTimeout(()=>{e.init()},100)}const t=document.getElementById("navbar");if(t){"semifull"===t.getAttribute("data-transparent-mode")&&"function"==typeof window.initSemifullScrollDetection&&window.initSemifullScrollDetection()}}),window.swup.hooks.on("visit:start",e=>{const n=document.getElementById("progress-bar");n&&(n.classList.remove("finishing","done"),n.offsetWidth,n.classList.add("loading"));const s=document.querySelector("body"),i=t(e.to.url,o("/"));i?s.classList.add("lg:is-home"):s.classList.remove("lg:is-home");const a=document.querySelector(".banner-home-text-overlay");a&&(i?a.classList.remove("hidden"):a.classList.add("hidden"));const d=document.getElementById("navbar");if(d){d.setAttribute("data-is-home",i.toString());"semifull"===d.getAttribute("data-transparent-mode")&&"function"==typeof window.initSemifullScrollDetection&&window.initSemifullScrollDetection()}const r=window.innerWidth<1024;if(r){const e=document.getElementById("post-list-container");e&&(e.style.transition="none")}const l=document.getElementById("wallpaper-wrapper"),c=document.querySelector(".absolute.w-full.z-30");r&&l&&c?i?(c.style.transition="none",l.style.display="",setTimeout(()=>{l.classList.remove("mobile-hide-banner")},100),setTimeout(()=>{c.classList.remove("mobile-main-no-banner"),setTimeout(()=>{c.style.transition=""},50)},150)):(l.classList.add("mobile-hide-banner"),setTimeout(()=>{c.classList.add("mobile-main-no-banner")},100)):!r&&l&&(l.style.display="",l.classList.remove("mobile-hide-banner"),c&&c.classList.remove("mobile-main-no-banner"));const m=document.getElementById("page-height-extend");m&&m.classList.remove("hidden");let u=document.getElementById("toc-wrapper");u&&u.classList.add("toc-not-ready"),window.scrollTo({top:0,behavior:"smooth"})}),window.swup.hooks.on("page:view",()=>{I(),B();const e=document.getElementById("page-height-extend");e&&e.classList.remove("hidden");window.innerWidth<1024&&setTimeout(()=>{const e=document.getElementById("post-list-container");e&&(e.style.transition="")},600);const t=localStorage.getItem("theme")||l.themeColor.defaultMode;let o=!1;o="system"===t?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"===t;const n=o?i.darkTheme:i.lightTheme;document.documentElement.getAttribute("data-theme")!==n&&document.documentElement.setAttribute("data-theme",n),setTimeout(()=>{if(document.getElementById("tcomment")){const e=new CustomEvent("firefly:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(e),console.log("Layout: 触发 firefly:page:loaded 事件，路径:",window.location.pathname)}},300)}),window.swup.hooks.on("visit:end",e=>{const t=document.getElementById("progress-bar");t&&(t.classList.remove("loading"),t.classList.add("finishing"),setTimeout(()=>{t.classList.remove("finishing"),t.classList.add("done"),setTimeout(()=>{t.classList.remove("done")},300)},200)),setTimeout(()=>{const e=document.getElementById("page-height-extend");e&&e.classList.add("hidden");const t=document.getElementById("toc-wrapper");t&&t.classList.remove("toc-not-ready"),document.documentElement.classList.remove("is-page-transitioning")},200)})};window?.swup?.hooks?w():document.addEventListener("swup:enable",w);let f,y=document.getElementById("back-to-top-btn"),b=document.getElementById("toc-wrapper"),L=document.getElementById("navbar-wrapper");function v(){const e=document.documentElement.scrollTop,t=window.innerHeight*(r/100),o=[];y&&o.push(()=>{e>t?y.classList.remove("hide"):y.classList.add("hide")}),u&&b&&o.push(()=>{e>t?b.classList.remove("toc-hide"):b.classList.add("toc-hide")}),u&&L&&o.push(()=>{const t=window.innerHeight*(d/100)-88;e>=t?L.classList.add("navbar-hidden"):L.classList.remove("navbar-hidden")}),o.length>0&&requestAnimationFrame(()=>{o.forEach(e=>e())})}window.addEventListener("scroll",()=>{f&&cancelAnimationFrame(f),f=requestAnimationFrame(v)},{passive:!0}),window.onresize=()=>{let e=Math.floor(window.innerHeight*(a/100));e-=e%4,document.documentElement.style.setProperty("--banner-height-extend",`${e}px`)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{g(),p()}):(g(),p());const E=()=>window.location.pathname.includes("/posts/")||window.location.pathname.includes("/post/");function I(){const e=document.getElementById("main-grid");if(!e)return;const t=E(),o=e.getAttribute("data-sidebar-position")||"left",n=e.getAttribute("data-tablet-sidebar")||"left",s="true"===e.getAttribute("data-show-both-sidebars-on-post"),i=t&&"both"!==o&&s;let a;if("both"===o||i){a="right"===(i&&"right"===o?"right":n)?"grid-cols-1 md:grid-cols-[1fr_17.5rem] xl:grid-cols-[17.5rem_1fr_17.5rem]":"grid-cols-1 md:grid-cols-[17.5rem_1fr] xl:grid-cols-[17.5rem_1fr_17.5rem]"}else a="right"===o?"grid-cols-1 md:grid-cols-[1fr_17.5rem]":"grid-cols-1 md:grid-cols-[17.5rem_1fr]";if(["grid-cols-1","md:grid-cols-[17.5rem_1fr]","md:grid-cols-[1fr_17.5rem]","xl:grid-cols-[17.5rem_1fr_17.5rem]"].forEach(t=>e.classList.remove(t)),a.split(" ").forEach(t=>t&&e.classList.add(t)),"right"===o){const t=document.getElementById("right-sidebar"),o=document.getElementById("swup-container"),n=e.querySelector(".footer");i?(t?.classList.add("xl:col-start-3"),o?.classList.add("xl:col-start-2","xl:col-end-3"),n&&(n.classList.remove("md:col-start-1","xl:col-start-1"),n.classList.add("xl:col-start-2"))):(t?.classList.remove("xl:col-start-3"),o?.classList.remove("xl:col-start-2","xl:col-end-3"),n&&(n.classList.add("md:col-start-1","xl:col-start-1"),n.classList.remove("xl:col-start-2")))}}function B(){const e=E();document.querySelectorAll(".widget-hide-on-post").forEach(t=>{e?t.classList.add("hidden"):t.classList.remove("hidden")}),document.querySelectorAll(".widget-hide-on-non-post").forEach(t=>{e?t.classList.remove("hidden"):t.classList.add("hidden")})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{I(),B(),n(),s(),c()}):(I(),B(),n(),s(),c());
